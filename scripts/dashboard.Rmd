---
title: "Untitled"
author: "Flavio"
date: "13 11 2020"
output: html_document
runtime: shiny
---

# **Information about Beer around the world**

  
<br>

### Using data from 2015 about Beerprices and Beer consumption (data from  goeurop now omio.de) to bild a small shinyapp with RMarkdown (codes and data on GitHub: https://github.com/fvr1210/beer_prices)
<br>
 

```{r packages, include=FALSE}

library(shiny) # Version 4.0.3
library(lubridate)
library(plotly)
library(ggthemes)
library(tidyverse) # Version 1.3.0
library(shinydashboard)

```


```{r daten, include=FALSE}
df_b <- read_delim("../processed-data/wwbp_add_var.csv", delim = ";" , locale = locale(encoding = 'ISO-8859-2'))


```
<br>

### Barplots for the different prices (supermarket, bar, average) in selected cities 
<br>

```{r daten_quality, include=FALSE}
infoBox("data quality", value = "Test", subtitle = NULL,
  icon = shiny::icon("bar-chart"), color = "aqua", width = 4,
  href = NULL, fill = FALSE)
```

```{r prices city regio, echo=F}
#choosing specific cities
checkboxGroupInput(inputId = "d_countries",label = "Select Countries:", inline = T,
                                                    choices = sort(unique(df_b$country)),
                                                    selected = sort(unique(df_b$country))) 

#choosing specific regions
checkboxGroupInput(inputId = "d_region", label = "Select Regions:", inline = T,
                                                    choices = sort(unique(df_b$region)),
                                                    selected = sort(unique(df_b$region))) 
```

```{r city_data_reaktiv, echo=F}
# filtering the reactive datasets based on the choices made
df_bC <- reactive({
  dplyr::filter(df_b, country %in% input$d_countries & region %in% input$d_region)
})

```

### Price for a Beer in a bar in USD (2015)
```{r plot prices bar, echo=F}
# setting colours otherwise they change each time a region is not selected
col_reg <- c( "Europe & Central Asia" = "green3", "East Asia & Pacific" = "chocolate1", "Latin America & Caribbean" = "coral1", "North America" = "darkgoldenrod3", "Middle East & North Africa" = "deepskyblue", "South Asia" = "orchid", "Sub-Saharan Africa" = "red") 


# Bar prices
 renderPlotly ({
  p_1 <- ggplot(df_bC(), aes(x=reorder(cc, -`BAR PRICE $`), y = `BAR PRICE $`, fill = region, text = paste("City:", cc, "\nPrice:", `BAR PRICE $`, "$"))) +
   geom_bar(stat="identity", position = position_dodge(width=0.9), width = 0.85, color = NA) +
   scale_fill_manual(values = col_reg) +
   # scale_fill_manual(values = col_age) +
   scale_x_discrete() +
   xlab("City") +
  ylab("Price for a Beer in a bar in USD") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, size = 7)) +
  theme(legend.title = element_blank()) +
  theme(legend.position = "bottom")
   
ggplotly(p_1, tooltip = "text")
     
 })
```

### Price for a Beer in a supermarkt in USD (2015)
```{r plot prices supermakrt, echo=F} 
# Supermarkt prices
 renderPlot ({
   ggplot(df_bC(), aes(x=reorder(cc, -`AVERAGE SUPERMARKET PRICE $`), y = `AVERAGE SUPERMARKET PRICE $`, fill = region)) +
   geom_bar(stat="identity", position = position_dodge(width=0.9), width = 0.85, color = NA) +
   scale_fill_manual(values = col_reg) +
   # scale_fill_manual(values = col_age) +
   scale_x_discrete() +
   xlab("City") +
  ylab("Price for a Beer in a supermarket in USD") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90))
 })

```


### Overall price for a Beer in USD (2015)
```{r plot prices overall, echo=F} 
# Supermarkt prices
 renderPlot ({
   ggplot(df_bC(), aes(x=reorder(cc, -`OVERALL PRICE $`), y = `OVERALL PRICE $`, fill = region)) +
   geom_bar(stat="identity", position = position_dodge(width=0.9), width = 0.85, color = NA) +
   scale_fill_manual(values = col_reg) +
   # scale_fill_manual(values = col_age) +
   scale_x_discrete() +
   xlab("City") +
  ylab(" Overall price for a Beer in USD") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90))
 })

```


### How much more does a beer cost in a bar than in the supermarket?
```{r plot prices markup, echo=F} 
# Supermarkt prices
 renderPlot ({
   ggplot(df_bC(), aes(x=reorder(cc, -markup), y = markup, fill = region)) +
   geom_bar(stat="identity", position = position_dodge(width=0.9), width = 0.85, color = NA) +
   scale_fill_manual(values = col_reg) +
   # scale_fill_manual(values = col_age) +
   scale_x_discrete() +
   xlab("City") +
  ylab(" Overall price for a Beer in USD") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90))
 })

```


